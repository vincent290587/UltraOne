/include/ "system-conf.dtsi"
#include <dt-bindings/thermal/thermal.h>
/ {

	reserved-memory {
		#address-cells = <2>;
		#size-cells = <2>;
		ranges;

		/* 128 MB reserved for tests on DMA */
		dma_src_reserved0: buffer@0000000050000000 {
			compatible = "shared-dma-pool";
			no-map;
			reg = <0x0 0x50000000 0x0 0x08000000>;
		};

		/* 128 MB reserved for tests on DMA */
		dma_src_reserved1: buffer@0000000060000000 {
			compatible = "shared-dma-pool";
			no-map;
			reg = <0x0 0x60000000 0x0 0x08000000>;
		};
	};

	/* Virtual PWM controller using your GPIO */
	soft_pwm: pwm-gpio {
		compatible = "pwm-gpio";
		#pwm-cells = <3>;
		/* GPIO number and polarity */
		gpios = <&fan_gpio 0 GPIO_ACTIVE_HIGH>;
	};

	/* Define the fan using the virtual PWM */
	fan0: pwm-fan {
		compatible = "pwm-fan";
		pwms = <&soft_pwm 0 10000 0>;
		cooling-levels = <8 16 64 192 255>;
		#cooling-cells = <2>;
	};

	misc_clk_a: misc_clk_a {
		#clock-cells = <0>;
		clock-frequency = <12000000>;
		compatible = "fixed-clock";
	};
	cam_reg_1v8: regulator-1v8 {
		compatible = "regulator-fixed";
		regulator-name = "1v8";
		regulator-min-microvolt = <1800000>;
		regulator-max-microvolt = <1800000>;
	};
	cam_reg_2v8: regulator-2v8 {
		compatible = "regulator-fixed";
		regulator-name = "2v8";
		regulator-min-microvolt = <2800000>;
		regulator-max-microvolt = <2800000>;
	};
	cam_reg_1v5: regulator-1v5 {
		compatible = "regulator-fixed";
		regulator-name = "1v5";
		regulator-min-microvolt = <1500000>;
		regulator-max-microvolt = <1500000>;
	};

};

// &axi_fifo_mm_s_0 {
// 	compatible = "xlnx,axi-fifo-mm-s-4.3", "xlnx,axi-fifo-mm-s-4.2", "xlnx,axi-fifo-mm-s-4.1";
// };

// &spw_0_axi_fifo_mm_s_0 {
// 	compatible = "xlnx,axi-fifo-mm-s-4.3", "xlnx,axi-fifo-mm-s-4.2", "xlnx,axi-fifo-mm-s-4.1";
// };

// &spw_1_axi_fifo_mm_s_0 {
// 	compatible = "xlnx,axi-fifo-mm-s-4.3", "xlnx,axi-fifo-mm-s-4.2", "xlnx,axi-fifo-mm-s-4.1";
// };

// &axi_dma_0 {
//     compatible = "sitf,spw_dma-1.0";
// 	memory-region = <&dma_src_reserved>;
// };

&spw_0_axi_dma_0 {
    compatible = "sitf,spw_dma-1.0";
	memory-region = <&dma_src_reserved0>;
};

&spw_1_axi_dma_0 {
    compatible = "sitf,spw_dma-1.0";
	memory-region = <&dma_src_reserved1>;
};

&pps_system_axi_gpio_0 {
	gpio-line-names = "ppsa", "ppsb", "ppsa_kill", "ppsb_kill";
};

&axi_gpio_btn {
	gpio-line-names = "btn1", "btn2", "btn3", "btn4";
};

&axi_gpio_leds {
	gpio-line-names = "led1", "led2", "led3", "led4";
};

&spw_0_axi_gpio {
	gpio-line-names = "spw0_linkdis", "spw0_linkstart", "spw0_div0", "spw0_div1", "spw0_div2", "spw0_div3", "spw0_div4", "spw0_div5", "spw0_div6", "spw0_div7",	"spw0_errdisc", "spw0_started", "spw0_running", "spw0_connecting", "spw0_errcred", "spw0_erresc", "spw0_errpar", "spw0_rxempty", "spw0_rxfull";
	xlnx,dout-default = <0x00000021>;
};

&spw_1_axi_gpio {
	gpio-line-names = "spw1_linkdis", "spw1_linkstart", "spw1_div0", "spw1_div1", "spw1_div2", "spw1_div3", "spw1_div4", "spw1_div5", "spw1_div6", "spw1_div7", "spw1_errdisc", "spw1_started", "spw1_running", "spw1_connecting", "spw1_errcred", "spw1_erresc", "spw1_errpar", "spw1_rxempty", "spw1_rxfull";
	xlnx,dout-default = <0x00000021>;
};

&fan_gpio {
	xlnx,dout-default = <0x00000001>;
};

&i2c1 {
	clock-frequency = <400000>;
	eeprom@50{
		compatible = "atmel,24c04";
		reg = <0x50>;
		pagesize = <16>;
	};
};

&qspi {
	status = "okay";
};

&flash0 {
	is-dual = <0>;
	num-cs = <1>;
	spi-rx-bus-width = <4>;
	spi-tx-bus-width = <4>;
	compatible ="jedec,spi-nor";
	reg= <0x0>;
};

/* SD */
&sdhci1 {
	disable-wp;
	no-1-8-v;
};

/* USB  */
&dwc3_0 {
	status = "okay";
	dr_mode = "host";
};

/* Ensure the AMS and fan are actually enabled */
&ams {
	status = "okay";
};

/ {
	thermal-zones {
		/delete-node/ pl-thermal; /* Remove your previous attempt if it exists */

		pl-thermal {
			polling-delay = <1500>;
			thermal-sensors = <&tsens_pl>;

			trips {
				fan_low: fan-low {
					temperature = <30000>; /* 30°C */
					hysteresis = <2000>;
					type = "active";
				};
				fan_mid: fan-mid {
					temperature = <45000>; /* 45°C */
					hysteresis = <2000>;
					type = "active";
				};
				fan_high: fan-high {
					temperature = <60000>; /* 60°C */
					hysteresis = <2000>;
					type = "active";
				};
			};

			cooling-maps {
				/* At 30C, set fan to level 1 (64/255 ~25% speed) */
				map1 {
					trip = <&fan_low>;
					cooling-device = <&fan0 1 1>;
				};
				/* At 45C, set fan to level 2 (128/255 ~50% speed) */
				map2 {
					trip = <&fan_mid>;
					cooling-device = <&fan0 2 2>;
				};
				/* At 60C, set fan to level 4 (255/255 = 100% speed) */
				map3 {
					trip = <&fan_high>;
					cooling-device = <&fan0 4 4>;
				};
			};
		};
	};
};
